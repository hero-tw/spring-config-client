#!/bin/bash

sudo apt-get update
sudo apt-get install -y openjdk-8-jdk
cd /home/ubuntu
curl https://archive.apache.org/dist/jmeter/binaries/apache-jmeter-3.3.tgz > jmeter.tgz
tar xvzf jmeter.tgz
cd apache-jmeter-3.3

export KEYSTORE=\
/u3+7QAAAAIAAAABAAAAAQADcm1pAAABZmlJBl4AAAUCMIIE/jAOBgorBgEEASoCEQEBBQAEggTq\
OpUqNdo4i/UrQq3Dnv6RXYHNG10RdtmO/pKWtreAusL/FwbfMdibPcwqOdR3rxBtQsXyZcrLH0oL\
HILWVIROnSECZdvNtTNuH5bZuE00HyUeiAN8bHLwdmZdSaXnprmyIYo42oX/88UeGHJtaIEOfndM\
KXADnHK2oo//uklyf0ZoW/eDLtb2o9g4T2mTalSa5u0Tnh3BWwoQSE4nXbPg3ql53oCAr1UGRQv1\
2YyJe0adramGx+gTRsAc1uc8fIhYETNWSqjk/Z7wXj/lPTDDSyScm0ow0SyF2S3cm/X1aZ5sk0FX\
TPPSArFt9x2IiA8t5XSKfnbRzSo0bojNL5MV1r796MQhIHCFUqiEfZzejvsqrMnxmtIDnbvsmHOZ\
TEDGU07d2uDn5Dbe+XS0l6eDQFAqZu1tkwBxcWK5Zfkv+dw/r13SP8BDVFRgMCioA2uOp1sO8+pg\
VpqafOER5IrtMO/ekXPufHVPEq1IY76HnUchbwZ4v+9ItjxOKamb2t9J85W+C0z5MDYKf++iivaO\
LxpMyZJ1jbk0W282Os8OurFpnhgbX4ItC7T16epgQ3aZ7YG5OIHw1UfJmaZKVuUN+DpWqT01C7/e\
J7BIyluv4soiepnuUS1QHYMD2leZ87MQY/hb7elKN8Cz9+scdl7Iso/QSDFhbU/ogE1eEuAdAMvC\
puqzvkmP0EX+Jqal5kC98KrM8vVKYY7mczJR+AZEbxFTSCHrgOap1AivaA74Nyf1la66qy7tekuX\
OOthbWEkezsrhd5ciu81aYhehqWU9A0EcWUEFxU0xKNmBGx9E21bhq9+uj9pkUlVGWTCQOQ+lLNq\
CQKr5yhra0bsmv9WQff6EmVuu3kQhTakXq5ISZalkWSCWIfYx6Al6odlRZCk35X6IwyVZDSskRt8\
0EQmCW1LmZYPho0pmqfoC+46ClWvZAT+LVqOjr6g3FOPMWdJXpKCPaowOSA6xdfjGAUN0hSIn47c\
t5eDBOxX9dL5RrfcEbAwlvI1Edrd/pc1tPKxmA1vXZLr4iO8vysCYpF8dk3GNn1iMgiVBLku37IE\
uwjDYoLb/KN4yy11Ls7K28oVYWxiOQJyHBn2GYyaGFV+6aNRgkM5mdqMJeks+3khsn+W4fEYA2mn\
Q6TqHfvp0HdmbD3wDKlxlCgolizt4q+GKsx40Y4SkupfoSaUC0He8uXxl2jwKnUOz0V8wI6GAKKP\
YzBQsK3M88Z6g5qds2KK8bNOpBs3bEBNpI4cTdw88UfirTvl92bPCovCuswQIz4rXq77hsLaCPz9\
7TbgeSJrQ9aebQcA6uDxpku2NmbsNkNkdwBryDd+mpx3LJWFpyd7AmJNZuESmdsN1hPgsJYngrAL\
2rm43Ff/KZISs4NJ5mtnQRQ+0FuVp+oB6ecrbHMPZLNd1YNwMw2fJx/0WWhAEYXpSe+xGXPUgU0D\
U4i2fLCFeAVOOGmxE5f5N+AUTzrNIhMrNh0mFlcFnLzf+GyD7v64iCWDTFIrvcwu+NcRDbSRykmA\
HIdjCFSRSTzbmyWvGIw2MsAF3pySfCd9j32bMP/E47DSndE/XCEigMxVex1+0VwHotFUhBuAvTtZ\
pZw4lbDjldjuS7P1wai+yTdcMTLbJWe32UP//jSpqJZcYsT4ZSxDtrukrhZt75DKmarqw/11nz+v\
3ZMvVQAAAAEABVguNTA5AAADmTCCA5UwggJ9oAMCAQICBCxFq/kwDQYJKoZIhvcNAQELBQAwezEL\
MAkGA1UEBhMCVVMxEDAOBgNVBAgTB0dlb3JnaWExEDAOBgNVBAcTB0F0bGFudGExFTATBgNVBAoT\
DFRob3VnaHR3b3JrczEZMBcGA1UECxMQVGhvdWdodHdvcmtzIEVGWDEWMBQGA1UEAxMNUm9iZXJ0\
IENvb3BlcjAeFw0xODEwMTIxNzE4MDBaFw0xODEwMTkxNzE4MDBaMHsxCzAJBgNVBAYTAlVTMRAw\
DgYDVQQIEwdHZW9yZ2lhMRAwDgYDVQQHEwdBdGxhbnRhMRUwEwYDVQQKEwxUaG91Z2h0d29ya3Mx\
GTAXBgNVBAsTEFRob3VnaHR3b3JrcyBFRlgxFjAUBgNVBAMTDVJvYmVydCBDb29wZXIwggEiMA0G\
CSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCtIHxWCVfkS0nr885+TAgy19tR0U/uaaZMUj7KjSOU\
7Bt/eog0qeOBGtifogYPKKRpuUJykEmkTkgqYKtPLXJ1FLCDBVTpuzluCqMLmjU5ZvtRZ74lhmJX\
/DLE46v51DXN2/kbb3JqbCIk3iSq2SxR2t7MsTWn6VqQSn/KYPYurGY/UtURQ5Bbrr9TRqV+91hz\
3sM9hRj2gyvM4ghRQI8aTKITjFtT0kIQ5M0H/HB8FhKKpWYcshzi0thWtjyEauHVxVPFJL4Tfscs\
jFWCxrh2J3nAyszkNdsYzX4QkIhCFqGH14sgG7L5oLZgzuxEvOoN11K4OFEmsTRrIXneIQZXAgMB\
AAGjITAfMB0GA1UdDgQWBBRBPFUL0rxFmsKNIIR6HD6FAjQBejANBgkqhkiG9w0BAQsFAAOCAQEA\
pX4oWStCDbTjgLy6hN9Nw6KUAQJCOYoYxgKe1djYmYlRQ/Z5w9EycDqvdH5Zzy5GNesXKZO71T+W\
WgRV4PiazgX/XE001fVWuy/3GIcSyT0FMWWgMWXLqoMu1jlC6nET615Ve+uIHUx1qXHRNEOjcb79\
haXZiOUWeeyBJvR99jTJxejjuDMCPh+HZHmf6vdrX7Uc7Cl5u6hqBcDUdJeVcQU0ELq+OTI/z6sj\
ZRTHbuIrqiJW09rbhFW9DkUeZeC7jY+XrrTVINcpkWWJS2/axJkZNX7wiWeNHPcinYOSeIewg+9F\
7No1StXfm01Be8lJbv/ptw+DeOkC6c0ErLT9CWtH46WJrJsiw8PH4bTKW71ETvut

echo $KEYSTORE | base64 -d > rmi_keystore.jks

echo "server_port=55501" >> bin/jmeter.properties
echo "server.rmi.localhostname=127.0.0.1" >> bin/jmeter.properties
echo "server.rmi.localport=55511" >> bin/jmeter.properties


export JVM_ARGS=-Xms256m
nohup bin/jmeter-server -Djava.rmi.server.hostname=127.0.0.1 &
cd ..
touch started

